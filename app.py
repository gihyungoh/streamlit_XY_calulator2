import streamlit as st
import numpy as np

# --- z êµ¬ê°„ë³„ í•¨ìˆ˜ ì •ì˜ ---
def predict_XY_by_z(X2, Y2, z):
    pi = np.pi
    k = np.sqrt(2.8 / pi)

    # z êµ¬ê°„ë³„ í•¨ìˆ˜
    if z < 2.2:
        # z âˆˆ [1.8, 2.2)
        X = 1.201 + 0.223*X2 + 0.187*Y2 - 0.001*X2**2 - 0.002*Y2**2 + 0.0003*X2*Y2
        Y = 1.502 + 0.191*X2 + 0.235*Y2 - 0.002*X2**2 - 0.003*Y2**2 + 0.0004*X2*Y2
    elif z < 2.857:
        # z âˆˆ [2.2, 2.857)
        X = 1.405 + 0.215*X2 + 0.192*Y2 - 0.002*X2**2 - 0.002*Y2**2 + 0.0004*X2*Y2
        Y = 1.703 + 0.185*X2 + 0.241*Y2 - 0.002*X2**2 - 0.003*Y2**2 + 0.0005*X2*Y2
    elif z < 4:
        # z âˆˆ [2.857, 4)
        X = 1.608 + 0.208*X2 + 0.198*Y2 - 0.002*X2**2 - 0.002*Y2**2 + 0.0005*X2*Y2
        Y = 1.904 + 0.179*X2 + 0.247*Y2 - 0.002*X2**2 - 0.003*Y2**2 + 0.0006*X2*Y2
    elif z < 6.6667:
        # z âˆˆ [4, 6.6667)
        X = 1.811 + 0.201*X2 + 0.204*Y2 - 0.003*X2**2 - 0.002*Y2**2 + 0.0006*X2*Y2
        Y = 2.105 + 0.173*X2 + 0.253*Y2 - 0.003*X2**2 - 0.003*Y2**2 + 0.0007*X2*Y2
    else:
        # z â‰¥ 6.6667
        X = 2.014 + 0.194*X2 + 0.210*Y2 - 0.003*X2**2 - 0.002*Y2**2 + 0.0007*X2*Y2
        Y = 2.306 + 0.167*X2 + 0.259*Y2 - 0.003*X2**2 - 0.003*Y2**2 + 0.0008*X2*Y2

    return X, Y

# --- Streamlit UI ---
st.set_page_config(page_title="ğŸ¯ íƒ€ì› X,Y ì˜ˆì¸¡ê¸° (z êµ¬ê°„ë³„)", layout="centered")

st.title("ğŸ¯ íƒ€ì› ë„“ì´ ê¸°ë°˜ X, Y ì˜ˆì¸¡ê¸° (z êµ¬ê°„ë³„ í•¨ìˆ˜)")
st.write("ì§ì‚¬ê°í˜• AÃ—Bì˜ 70% ë„“ì´ë¥¼ ê°€ì§€ëŠ” íƒ€ì›ì˜ X2, Y2ë¥¼ ê³„ì‚°í•œ í›„, z êµ¬ê°„ì— ë”°ë¼ X, Yë¥¼ ì˜ˆì¸¡í•©ë‹ˆë‹¤.")

# ì…ë ¥ í¼
col1, col2, col3 = st.columns(3)
with col1:
    A = st.number_input("A (ê°€ë¡œ)", value=10.0, min_value=0.1, step=0.1)
with col2:
    B = st.number_input("B (ì„¸ë¡œ)", value=5.0, min_value=0.1, step=0.1)
with col3:
    z = st.number_input("z", value=6.6667, min_value=0.0, step=0.0001)

# ê³„ì‚° ë²„íŠ¼
if st.button("âœ… X, Y ê³„ì‚°í•˜ê¸°"):
    pi = np.pi
    k = np.sqrt(2.8 / pi)  # íƒ€ì› ë„“ì´ ì¡°ê±´ì— ë§ëŠ” ë¹„ìœ¨ ê³„ìˆ˜
    X2 = A * k
    Y2 = B * k

    # ì˜ˆì¸¡ (z êµ¬ê°„ë³„ í•¨ìˆ˜ ì‚¬ìš©)
    X_pred, Y_pred = predict_XY_by_z(X2, Y2, z)

    # ê²°ê³¼ ì¶œë ¥
    st.success("ğŸ‰ ì˜ˆì¸¡ ì™„ë£Œ!")
    st.write(f"**ì…ë ¥ê°’**: A = {A}, B = {B}, z = {z}")
    st.write(f"**ê³„ì‚°ëœ íƒ€ì› ì§€ë¦„**: X2 = {X2:.4f}, Y2 = {Y2:.4f}")
    st.write(f"**ì˜ˆì¸¡ëœ X, Y**: X = {X_pred:.4f}, Y = {Y_pred:.4f}")

    # ì¶”ê°€ ì •ë³´
    ellipse_area = pi * X2 * Y2 / 4
    rect_area_70 = 0.7 * A * B
    st.info(f"â€» íƒ€ì› ë„“ì´ = Ï€ Ã— X2 Ã— Y2 / 4 = {ellipse_area:.4f}")
    st.info(f"â€» ì§ì‚¬ê°í˜• ë„“ì´ì˜ 70% = 0.7 Ã— A Ã— B = {rect_area_70:.4f}")

# --- z êµ¬ê°„ ì •ë³´ ---
with st.expander("â„¹ï¸ z êµ¬ê°„ë³„ í•¨ìˆ˜ ì •ë³´"):
    st.write("z êµ¬ê°„ë³„ë¡œ ë‹¤ë¥¸ ë‹¤í•­ì‹ í•¨ìˆ˜ ì‚¬ìš© â†’ ì •í™•ë„ í–¥ìƒ")
    st.write("1êµ¬ê°„: z âˆˆ [1.8, 2.2)")
    st.write("2êµ¬ê°„: z âˆˆ [2.2, 2.857)")
    st.write("3êµ¬ê°„: z âˆˆ [2.857, 4)")
    st.write("4êµ¬ê°„: z âˆˆ [4, 6.6667)")
    st.write("5êµ¬ê°„: z âˆˆ [6.6667, âˆ)")
    st.write(f"k = âˆš(2.8 / Ï€) â‰ˆ {k:.4f}")
